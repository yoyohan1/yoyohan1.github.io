window.__require=function t(e,o,i){function c(n,r){if(!o[n]){if(!e[n]){var a=n.split("/");if(a=a[a.length-1],!e[a]){var h="function"==typeof __require&&__require;if(!r&&h)return h(a,!0);if(s)return s(a,!0);throw new Error("Cannot find module '"+n+"'")}}var u=o[n]={exports:{}};e[n][0].call(u.exports,function(t){return c(e[n][1][t]||t)},u,u.exports,t,e,o,i)}return o[n].exports}for(var s="function"==typeof __require&&__require,n=0;n<i.length;n++)c(i[n]);return c}({CameraSpin:[function(t,e,o){"use strict";cc._RF.push(e,"9c96ed3nqhBD6cq86tc+aqd","CameraSpin"),Object.defineProperty(o,"__esModule",{value:!0});var i=cc._decorator,c=i.ccclass,s=i.property,n=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.target=null,e.camera=null,e.xSpeed=5,e.ySpeed=5,e.yMinLimit=-90,e.yMaxLimit=90,e.leftMax=-365,e.rightMax=365,e.minDistance=1,e.maxDistance=100,e.G_fZoomSpeed=-16,e._cameraPos=cc.Vec3.ZERO,e._targetPos=cc.Vec3.ZERO,e.x=0,e.y=0,e.z=0,e.distance=5,e.rotation=new cc.Quat,e.position=cc.Vec3.ZERO,e.curTouchCount=0,e}return __extends(e,t),Object.defineProperty(e.prototype,"cameraNode",{get:function(){return null==this._cameraNode&&(this._cameraNode=this.camera.node),this._cameraNode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cameraPos",{get:function(){return this.cameraNode.getPosition(this._cameraPos),this._cameraPos},set:function(t){this.cameraNode.setPosition(t),this._cameraPos=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"targetPos",{get:function(){return this.target.getPosition(this._targetPos),this._targetPos},enumerable:!0,configurable:!0}),e.prototype.start=function(){this.SetPoint(this.cameraPos),this.node.on(cc.Node.EventType.MOUSE_DOWN,this.onMouseDown,this),this.node.on(cc.Node.EventType.MOUSE_UP,this.onMouseUp,this),this.node.on(cc.Node.EventType.MOUSE_WHEEL,this.onMouseWheel,this),this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this)},e.prototype.onDestroy=function(){this.node.off(cc.Node.EventType.MOUSE_DOWN,this.onMouseDown,this),this.node.off(cc.Node.EventType.MOUSE_UP,this.onMouseUp,this),this.node.off(cc.Node.EventType.MOUSE_WHEEL,this.onMouseWheel,this),this.node.off(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this)},e.prototype.SetPoint=function(t){this.distance=this.targetPos.sub(this.cameraPos).mag(),console.log("\u8bbe\u7f6e distance:"+this.distance),this.cameraPos=t,this.position=t,this.x=this.cameraNode.eulerAngles.y,this.y=this.cameraNode.eulerAngles.x,this.z=0,this.cameraNode.lookAt(this.targetPos),this.cameraNode.getRotation(this.rotation)},e.prototype.onTouchStart=function(t){var e=t.getTouches();1==e.length?(console.log("onTouchStart 1"),this.curTouchCount=1):2==e.length&&(console.log("onTouchStart 2"),this.curTouchCount=2)},e.prototype.onTouchMove=function(t){2==t.getTouches().length&&(this.curTouchCount=2),1==this.curTouchCount?this.onTouchOne(t):2==this.curTouchCount&&this.onTouchTwo(t)},e.prototype.onTouchTwo=function(t){var e=t.getTouches();if(2==e.length){var o=e[1].getPreviousLocation().sub(e[0].getPreviousLocation()).mag(),i=(e[1].getLocation().sub(e[0].getLocation()).mag()-o)/100;this.processToFarAndNear(i)}},e.prototype.processToFarAndNear=function(t){var e=cc.Vec3.ZERO,o=cc.Vec3.ZERO;this.cameraNode.getPosition(e),this.target.getPosition(o);var i=e.add(e.sub(o).normalize().mul(t*this.G_fZoomSpeed*.5));this.cameraNode.setPosition(i);var c=o.sub(o.sub(e).normalize().mul(this.minDistance)),s=o.sub(o.sub(e).normalize().mul(this.maxDistance)),n=c.x<s.x?cc.misc.clampf(i.x,c.x,s.x):cc.misc.clampf(i.x,s.x,c.x),r=c.y<s.y?cc.misc.clampf(i.y,c.y,s.y):cc.misc.clampf(i.y,s.y,c.y),a=c.z<s.z?cc.misc.clampf(i.z,c.z,s.z):cc.misc.clampf(i.z,s.z,c.z);this.cameraNode.setPosition(new cc.Vec3(n,r,a)),this.isTiaoJie=!0},e.prototype.onTouchOne=function(t){1==this.isTiaoJie&&(this.SetPoint(this.cameraPos),this.isTiaoJie=!1);var e=t.getPreviousLocation(),o=t.getLocation().sub(e);this.y>90&&this.y<270||this.y<-90&&this.y>-270?this.x=this.x+o.x*this.xSpeed*.13:this.x=this.x-o.x*this.xSpeed*.13,this.y=this.y-o.y*this.ySpeed*-.13,this.y>180&&(this.y-=360),this.x=this.ClampAngle(this.x,this.leftMax,this.rightMax),this.y=this.ClampAngle(this.y,this.yMinLimit,this.yMaxLimit),this.distance=cc.misc.clampf(this.distance,this.minDistance,this.maxDistance),this.rotation=this.rotation.fromEuler(new cc.Vec3(this.y,this.x,this.z));var i=new cc.Vec3(0,0,this.distance);this.position=this.QuatMulVec(this.rotation,i).add(new cc.Vec3(this.target.x,this.target.y,this.target.z)),this.cameraNode.setPosition(this.position);var c=cc.Vec3.ZERO;this.rotation.toEuler(c),this.cameraNode.eulerAngles=c},e.prototype.ClampAngle=function(t,e,o){return t<-360&&(t+=360),t>360&&(t-=360),cc.misc.clampf(t,e,o)},e.prototype.onMouseWheel=function(t){if(cc.sys.platform==cc.sys.WIN32){var e=t.getScrollY();this.processToFarAndNear(e)}},e.prototype.onMouseDown=function(t){var e=t.getButton();if(e===cc.Event.EventMouse.BUTTON_LEFT){var o=t.getLocation();this.node.convertToNodeSpace(o);console.log("!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! \u9f20\u6807\u5de6\u952e\u6309\u4e0b:")}else e===cc.Event.EventMouse.BUTTON_MIDDLE||cc.Event.EventMouse.BUTTON_RIGHT},e.prototype.onMouseUp=function(t){var e=t.getButton();if(e===cc.Event.EventMouse.BUTTON_LEFT){var o=t.getLocation();this.node.convertToNodeSpace(o)}else e===cc.Event.EventMouse.BUTTON_MIDDLE||cc.Event.EventMouse.BUTTON_RIGHT},e.prototype.QuatMulVec=function(t,e){var o=2*t.x,i=2*t.y,c=2*t.z,s=t.x*o,n=t.y*i,r=t.z*c,a=t.x*i,h=t.x*c,u=t.y*c,p=t.w*o,d=t.w*i,y=t.w*c,m=cc.Vec3.ONE;return m.x=(1-(n+r))*e.x+(a-y)*e.y+(h+d)*e.z,m.y=(a+y)*e.x+(1-(s+r))*e.y+(u-p)*e.z,m.z=(h-d)*e.x+(u+p)*e.y+(1-(s+n))*e.z,m},__decorate([s(cc.Node)],e.prototype,"target",void 0),__decorate([s(cc.Camera)],e.prototype,"camera",void 0),__decorate([s],e.prototype,"xSpeed",void 0),__decorate([s],e.prototype,"ySpeed",void 0),__decorate([s],e.prototype,"yMinLimit",void 0),__decorate([s],e.prototype,"yMaxLimit",void 0),__decorate([s],e.prototype,"minDistance",void 0),__decorate([s],e.prototype,"maxDistance",void 0),__decorate([s],e.prototype,"G_fZoomSpeed",void 0),e=__decorate([c],e)}(cc.Component);o.default=n,cc._RF.pop()},{}]},{},["CameraSpin"]);