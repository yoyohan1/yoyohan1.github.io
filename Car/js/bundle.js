!function(){"use strict";class a{static Vec_Add(a,e){var t=new Laya.Vector3;return Laya.Vector3.add(a,e,t),t}static Vec_Sub(a,e){var t=new Laya.Vector3;return Laya.Vector3.subtract(a,e,t),t}static Vec_Mul(a,e){var t=new Laya.Vector3;return Laya.Vector3.multiply(a,new Laya.Vector3(e,e,e),t),t}static Vec_Normalize(a){var e=new Laya.Vector3;return Laya.Vector3.normalize(a,e),e}static VecToQua(a){var e=new Laya.Quaternion;return Laya.Quaternion.createFromYawPitchRoll(a.y*Math.PI/180,a.x*Math.PI/180,a.z*Math.PI/180,e),e}static VecDotQua(a,e){var t=new Laya.Vector3;return Laya.Vector3.transformQuat(a,e,t),t}static Clamp(a,e,t){return a<e?e:a>t?t:a}static ClampAngle(e,t,s){return e<-360&&(e+=360),e>360&&(e-=360),a.Clamp(e,t,s)}static QuaToVec(a){var e=new Laya.Vector3;return a.getYawPitchRoll(e),e=new Laya.Vector3(180*e.y/Math.PI,180*e.x/Math.PI,180*e.z/Math.PI)}static GetToTargetRotation(e){var t=new Laya.Quaternion;return Laya.Quaternion.rotationLookAt(e,a.VEC_UP,t),t}}a.VEC_UP=new Laya.Vector3(0,1,0);class e extends Laya.Script3D{constructor(){super(),this.G_fZoomSpeed=-16,this.distance=5,this.minDistance=.6,this.maxDistance=20,this.x=0,this.y=0,this.z=0,this.yMinLimit=-90,this.yMaxLimit=90,this.leftMax=-365,this.rightMax=365,this.xSpeed=5,this.ySpeed=5,this.rotation=new Laya.Quaternion,this.position=new Laya.Vector3,this.curTouchCount=0}get targetPos(){return this.target.transform.position}get cameraPos(){return null==this._cameraPos&&(this._cameraPos=this.cameraNode.transform.position),this._cameraPos}set cameraPos(a){this.cameraNode.transform.position=a}get cameraRot(){return null==this._cameraRot&&(this._cameraRot=this.cameraNode.transform.rotation),this._cameraRot}set cameraRot(a){this.cameraNode.transform.rotation=a}get camViewTargetPos(){return null==this._camViewTargetPos&&(this._camViewTargetPos=this.targetPos),this._camViewTargetPos}set camViewTargetPos(a){this._camViewTargetPos=a}onStart(){this.cameraNode=t.instance.scene3D.getChildByName("Main Camera"),this.target=t.instance.scene3D.getChildByName("Sportscar_LOD0").getChildByName("ViewPoint"),Laya.stage.on(Laya.Event.MOUSE_DOWN,this,this.handleMouseDown),Laya.stage.on(Laya.Event.MOUSE_UP,this,this.handleMouseUp),Laya.stage.on(Laya.Event.MOUSE_WHEEL,this,this.handleMouseWheel),this.SetCamPoint(this.cameraPos)}SetCamPoint(e){this.cameraPos=e;var t=a.GetToTargetRotation(a.Vec_Sub(this.camViewTargetPos,this.cameraPos));this.cameraRot=t,this.AdjustValue(),this.cameraPos=a.Vec_Add(a.VecDotQua(new Laya.Vector3(0,0,this.distance),this.rotation),this.camViewTargetPos)}AdjustValue(){this.distance=Laya.Vector3.distance(this.camViewTargetPos,this.cameraPos),this.position=this.cameraPos,this.rotation=this.cameraRot,this.x=a.QuaToVec(this.cameraRot).x,this.y=a.QuaToVec(this.cameraRot).y,this.z=a.QuaToVec(this.cameraRot).z}handleMouseDown(a){var e=a.touches;null==e&&((e=new Array)[0]=a),this.curTouchCount=e.length,this.oldTouch0=new Laya.Vector3(e[0].stageX,e[0].stageY,0),2==this.curTouchCount&&(this.oldTouch1=new Laya.Vector3(e[1].stageX,e[1].stageY,0)),Laya.stage.on(Laya.Event.MOUSE_MOVE,this,this.handleMouseMove),Laya.stage.on(Laya.Event.MOUSE_OUT,this,this.handleMouseUp)}handleMouseMove(a){var e=a.touches;null==e&&((e=new Array)[0]=a),2==e.length&&(this.curTouchCount=2),1==this.curTouchCount?this.onTouchOne(e[0]):2==this.curTouchCount&&this.onTouchTwo(a)}onTouchOne(e){1==this.isNeedAdjust&&(this.AdjustValue(),this.isNeedAdjust=!1),this.newTouch0=new Laya.Vector3(e.stageX,e.stageY,0);var t=a.Vec_Sub(this.newTouch0,this.oldTouch0);this.x+=t.y*this.xSpeed*-.05,this.y+=t.x*this.ySpeed*-.05,this.distance=a.Clamp(this.distance,this.minDistance,this.maxDistance),this.x=a.Clamp(this.x,-90,90),this.rotation=a.VecToQua(new Laya.Vector3(this.x,this.y,this.z)),this.position=a.Vec_Add(a.VecDotQua(new Laya.Vector3(0,0,this.distance),this.rotation),this.camViewTargetPos),this.cameraPos=this.position,this.cameraRot=this.rotation,this.oldTouch0=this.newTouch0}onTouchTwo(a){var e=a.touches;if(null!=e||2==e.length){this.newTouch0=new Laya.Vector3(e[0].stageX,e[0].stageY,0),this.newTouch1=new Laya.Vector3(e[1].stageX,e[1].stageY,0);var t=Laya.Vector3.distance(this.oldTouch0,this.oldTouch1),s=Laya.Vector3.distance(this.newTouch0,this.newTouch1)-t;this.processToFarAndNear(s/30),this.oldTouch0=this.newTouch0,this.oldTouch1=this.newTouch1}}HorVerMoveByTouch(e){var t=a.Vec_Mul(a.Vec_Add(this.newTouch0,this.newTouch1),.5),s=a.Vec_Mul(a.Vec_Add(this.oldTouch0,this.oldTouch1),.5),o=a.Vec_Mul(a.Vec_Sub(t,s),.0025);if(Laya.Vector3.scalarLength(o)>.005){var i=a.VecDotQua(new Laya.Vector3(-o.x,o.y,0),this.cameraRot);this.cameraPos=a.Vec_Add(this.cameraPos,i),this.camViewTargetPos=a.Vec_Add(this.camViewTargetPos,i),this.isNeedAdjust=!0}}handleMouseUp(a){Laya.stage.off(Laya.Event.MOUSE_MOVE,this,this.handleMouseMove),Laya.stage.off(Laya.Event.MOUSE_OUT,this,this.handleMouseUp),this.AdjustValue()}handleMouseWheel(a){var e=a.delta;this.processToFarAndNear(e)}processToFarAndNear(e){if(Math.abs(e)>.02){var t=a.Vec_Add(this.cameraPos,a.Vec_Mul(a.Vec_Normalize(a.Vec_Sub(this.cameraPos,this.camViewTargetPos)),e*this.G_fZoomSpeed*.01)),s=a.Vec_Sub(this.camViewTargetPos,a.Vec_Mul(a.Vec_Normalize(a.Vec_Sub(this.camViewTargetPos,this.cameraPos)),this.minDistance)),o=a.Vec_Sub(this.camViewTargetPos,a.Vec_Mul(a.Vec_Normalize(a.Vec_Sub(this.camViewTargetPos,this.cameraPos)),this.maxDistance));t.x=s.x<o.x?a.Clamp(t.x,s.x,o.x):a.Clamp(t.x,o.x,s.x),t.y=s.y<o.y?a.Clamp(t.y,s.y,o.y):a.Clamp(t.y,o.y,s.y),t.z=s.z<o.z?a.Clamp(t.z,s.z,o.z):a.Clamp(t.z,o.z,s.z),this.cameraPos=t,this.isNeedAdjust=!0}}}class t extends Laya.Script{constructor(){super()}onAwake(){t.instance=this}onEnable(){}onDisable(){}onStart(){Laya.Scene3D.load("res/LayaScene_SampleScene/Conventional/SampleScene.ls",Laya.Handler.create(this,this.onLoadSceneCmp))}onLoadSceneCmp(a){Laya.stage.addChild(a),this.scene3D=a,a.zOrder=-1;var t=a.getChildByName("Main Camera");t.transform.position=new Laya.Vector3(0,.92,10.23),t.addComponent(e),this.colorPicker=this.owner.getChildByName("ColorPicker"),this.colorPicker.changeHandler=new Laya.Handler(this,this.onChangeColor,[this.colorPicker]),this.door=a.getChildByName("Sportscar_LOD0").getChildByName("Doors")}onChangeColor(a){console.log(a.selectedColor),this.door.meshRenderer.sharedMaterial.albedoColor=this.getColorByString(a.selectedColor)}getColorByString(a){for(var e=a.toLowerCase(),t=[],s=1;s<7;s+=2)t.push(parseInt("0x"+e.slice(s,s+2)));return new Laya.Vector4(t[0]/255,t[1]/255,t[2]/255,1)}}class s{constructor(){}static init(){(0,Laya.ClassUtils.regClass)("scripts/GameMgr.ts",t)}}s.width=720,s.height=1280,s.scaleMode="showall",s.screenMode="none",s.alignV="middle",s.alignH="center",s.startScene="Main.scene",s.sceneRoot="",s.debug=!1,s.stat=!1,s.physicsDebug=!1,s.exportSceneToJson=!0,s.init();new class{constructor(){window.Laya3D?Laya3D.init(s.width,s.height):Laya.init(s.width,s.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=s.scaleMode,Laya.stage.screenMode=s.screenMode,Laya.stage.alignV=s.alignV,Laya.stage.alignH=s.alignH,Laya.URL.exportSceneToJson=s.exportSceneToJson,(s.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),s.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),s.stat&&Laya.Stat.show(),Laya.alertGlobalError(!0),Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){s.startScene&&Laya.Scene.open(s.startScene)}}}();